1.
CREATE TABLE 고객(
    고객번호 NUMBER(3) NOT NULL,
    고객이름 VARCHAR(5) NOT NULL,
    주문회수 NUMBER(3) NOT NULL,
    CONSTRAINT 고객_PK PRIMARY KEY (고객번호)
);

CREATE TABLE 물품(
    물품번호 NUMBER(3) NOT NULL,
    물품명 VARCHAR(5) NOT NULL,
    재고량 NUMBER(3) NOT NULL,
    CONSTRAINT 물품_PK PRIMARY KEY (물품번호)
);

CREATE TABLE 주문(
    고객번호 NUMBER(3) NOT NULL,
    물품번호 NUMBER(3) NOT NULL,
    주문량 NUMBER(3) NOT NULL,
    CONSTRAINT 주문_PK PRIMARY KEY (고객번호, 물품번호),
    CONSTRAINT 주문_고객_FK FOREIGN KEY(고객번호) REFERENCES 고객(고객번호),
    CONSTRAINT 주문_물품_FK FOREIGN KEY(물품번호) REFERENCES 물품(물품번호)
);

2.
CREATE SEQUENCE 고객_번호
   INCREMENT BY 1
   START WITH 100
   MAXVALUE 1000
   NOCYCLE
   NOCACHE;

CREATE SEQUENCE 물품_번호
   INCREMENT BY 1
   START WITH 200
   MAXVALUE 1000
   NOCYCLE
   NOCACHE;


INSERT INTO 고객 VALUES (고객_번호.NEXTVAL, 'C1', 2);
INSERT INTO 고객 VALUES (고객_번호.NEXTVAL, 'C2', 1);
INSERT INTO 고객 VALUES (고객_번호.NEXTVAL, 'C3', 1);
INSERT INTO 고객 VALUES (고객_번호.NEXTVAL, 'C4', 5);
INSERT INTO 고객 VALUES (고객_번호.NEXTVAL, 'C5', 0);
INSERT INTO 물품 VALUES (물품_번호.NEXTVAL, 'R1', 100);
INSERT INTO 물품 VALUES (물품_번호.NEXTVAL, 'R2', 100);
INSERT INTO 물품 VALUES (물품_번호.NEXTVAL, 'R3', 100);
INSERT INTO 물품 VALUES (물품_번호.NEXTVAL, 'R4', 100);
INSERT INTO 물품 VALUES (물품_번호.NEXTVAL, 'R5', 100);
INSERT INTO 주문 VALUES (101, 201, 5);
INSERT INTO 주문 VALUES (101, 202, 7);
INSERT INTO 주문 VALUES (102, 203, 5);
INSERT INTO 주문 VALUES (103, 201, 6);
INSERT INTO 주문 VALUES (104, 201, 5);
INSERT INTO 주문 VALUES (104, 202, 4);
INSERT INTO 주문 VALUES (104, 203, 10);
INSERT INTO 주문 VALUES (104, 204, 7);
INSERT INTO 주문 VALUES (104, 205, 3);

SELECT * FROM 고객;
SELECT * FROM 주문;
SELECT * FROM 물품;

3.
DELETE 고객 WHERE 고객번호 = 101;
INSERT INTO 주문 VALUES (105, 206, 2);

4.
UPDATE 물품
SET 재고량 = 재고량 - (SELECT SUM(주문량) FROM 주문 WHERE 물품.물품번호 = 주문.물품번호);
SELECT * FROM 물품;

5.
CREATE OR REPLACE TRIGGER 재고계산
AFTER INSERT ON 주문
FOR EACH ROW
BEGIN
    UPDATE 물품
    SET 재고량 = 재고량 - :NEW.주문량
    WHERE :NEW.물품번호 = 물품번호;
END;
/

INSERT INTO 주문 VALUES (103, 202, 10);

SELECT * FROM 물품;

6.
CREATE OR REPLACE VIEW 주문현황 AS
SELECT 고객이름 AS 고객이름, 물품명 AS 물품명, 주문량
FROM 주문
JOIN 물품 ON 물품.물품번호 = 주문.물품번호
JOIN 고객 ON 고객.고객번호 = 주문.고객번호;

SELECT * FROM 주문현황;

7-1.
SELECT 고객이름
FROM 주문현황
WHERE 물품명 = 'R1';

7-2.

7-3.

7-4.

DROP VIEW 주문현황;
DROP TRIGGER 재고계산;
DROP SEQUENCE 고객_번호;
DROP SEQUENCE 물품_번호;
DROP TABLE 주문;
DROP TABLE 물품;
DROP TABLE 고객;
